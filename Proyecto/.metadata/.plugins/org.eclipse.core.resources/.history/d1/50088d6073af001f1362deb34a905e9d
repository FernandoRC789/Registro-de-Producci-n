<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>
<link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body>
	<%
	String usuario = request.getParameter("usuario");
    String contraseña = request.getParameter("contraseña");

    // Establecer la conexión con la base de datos
    Connection connection = null;
    PreparedStatement statement = null;
    ResultSet resultSet = null;

    try {
        // Cargar el driver JDBC
        Class.forName("com.mysql.cj.jdbc.Driver");
        
        // Conectar a la base de datos (ajusta la URL, usuario y contraseña)
        String url = "jdbc:mysql://localhost:3306/BDT1_RODRIGUEZ"; // Cambia el puerto si es necesario
        String dbUsuario = "root"; // Cambia el usuario si es necesario
        String dbContraseña = "123456"; // Cambia la contraseña si es necesario
        
        connection = DriverManager.getConnection(url, dbUsuario, dbContraseña);

        // Preparar la consulta SQL para verificar las credenciales
        String sql = "SELECT * FROM USUARIOS WHERE NOM_USUARIO = ? AND CONTRASENA = ?";
        statement = connection.prepareStatement(sql);
        statement.setString(1, usuario);
        statement.setString(2, contraseña);
        resultSet = statement.executeQuery();

        // Verificar si el usuario y la contraseña son correctos
        if (resultSet.next()) {
            // Redirigir a otra página (por ejemplo, dashboard.jsp)
            response.sendRedirect("dashboard.html");
        } else {
            // Mostrar mensaje de error si las credenciales no coinciden
            response.setContentType("text/html");
            PrintWriter out = response.getWriter();
            out.println("<html><body>");
            out.println("<h3>Usuario o contraseña incorrectos.</h3>");
            out.println("<a href='login.html'>Intentar de nuevo</a>");
            out.println("</body></html>");
        }

    } catch (Exception e) {
        e.printStackTrace();
    } finally {
        try {
            if (resultSet != null) resultSet.close();
            if (statement != null) statement.close();
            if (connection != null) connection.close();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
	%>
	<div class="Registro-sesion">
		<img src="img/farmexlogo.png" alt="logo de farmex">
		
		<form action="login" method="post" class="formulario">
			<div>
                <label for="turno">TURNO:</label>
				<select name="lenguajes" id="lang">
			        <option value="primero">PRIMERO</option>
			        <option value="segundo">SEGUNDO</option>
			        <option value="tercero">TERCERO</option>
			    </select>            
			</div>
            <div>
                <label for="usuario">USUARIO:</label>
                <input type="text" id="usuario" name="usuario">
            </div>
            <div>
                <label for="contraseña">CONTRASEÑA:</label>
                <input type="password" id="contraseña" name="contraseña">
            </div>
			
			<button id="btnAceptar">ACEPTAR</button>
			<button id="btnCerrar">CERRAR</button>
		</form>
	</div>

</body>
</html>